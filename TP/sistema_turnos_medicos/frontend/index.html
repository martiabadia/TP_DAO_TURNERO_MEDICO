<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gestión de Turnos Médicos</title>
    <link rel="stylesheet" href="/static/css/styles.css?v=9">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <!-- Sidebar -->
    <div id="sidebar" class="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <i class="fas fa-hospital"></i>
                <span>Turnos Médicos</span>
            </div>
            <button class="sidebar-close" onclick="toggleSidebar()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <nav class="sidebar-nav">
            <button class="nav-btn active" data-page="home">
                <i class="fas fa-home"></i>
                <span>Inicio</span>
            </button>
            <button class="nav-btn" data-page="turnos">
                <i class="fas fa-calendar-check"></i>
                <span>Reservar Turno</span>
            </button>
            <button class="nav-btn" data-page="mis-turnos">
                <i class="fas fa-list"></i>
                <span>Turnos</span>
            </button>
            <button class="nav-btn" data-page="pacientes">
                <i class="fas fa-users"></i>
                <span>Pacientes</span>
            </button>
            <button class="nav-btn" data-page="medicos">
                <i class="fas fa-user-md"></i>
                <span>Médicos</span>
            </button>
            <button class="nav-btn" data-page="especialidades">
                <i class="fas fa-stethoscope"></i>
                <span>Especialidades</span>
            </button>
            <button class="nav-btn" data-page="horarios">
                <i class="fas fa-clock"></i>
                <span>Horarios</span>
            </button>
            <button class="nav-btn" data-page="historial">
                <i class="fas fa-file-medical"></i>
                <span>Historial Clínico</span>
            </button>
            <button class="nav-btn" data-page="reportes">
                <i class="fas fa-chart-bar"></i>
                <span>Reportes</span>
            </button>
        </nav>
    </div>

    <!-- Overlay -->
    <div id="sidebar-overlay" class="sidebar-overlay" onclick="toggleSidebar()"></div>

    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <button class="menu-toggle" onclick="toggleSidebar()">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="logo">
                    <i class="fas fa-hospital"></i>
                    <span>Sistema de Turnos Médicos</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Home Page -->
        <section id="home-page" class="page active">
            <div class="container">
                <div class="hero">
                    <h1>Bienvenido al Sistema de Turnos Médicos</h1>
                    <p>Gestiona tus consultas médicas de manera simple y eficiente</p>
                    <button class="btn btn-primary btn-large" onclick="navigateTo('turnos')">
                        <i class="fas fa-calendar-plus"></i>
                        Reservar Turno Ahora
                    </button>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <i class="fas fa-user-md"></i>
                        <div class="stat-info">
                            <h3 id="stat-medicos">-</h3>
                            <p>Médicos Disponibles</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-stethoscope"></i>
                        <div class="stat-info">
                            <h3 id="stat-especialidades">-</h3>
                            <p>Especialidades</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-calendar-alt"></i>
                        <div class="stat-info">
                            <h3 id="stat-turnos">-</h3>
                            <p>Turnos Emitidos en el Mes</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-users"></i>
                        <div class="stat-info">
                            <h3 id="stat-pacientes">-</h3>
                            <p>Pacientes Registrados</p>
                        </div>
                    </div>
                </div>

                <div class="info-section">
                    <h2>¿Cómo funciona?</h2>
                    <div class="steps-grid">
                        <div class="step-card">
                            <div class="step-number">1</div>
                            <h3>Reservá turnos</h3>
                            <p>Reservá turnos para los pacientes de la clínica</p>
                        </div>
                        <div class="step-card">
                            <div class="step-number">2</div>
                            <h3>Gestioná la clínica</h3>
                            <p>Gestioná pacientes, médicos y especialidades</p>
                        </div>
                        <div class="step-card">
                            <div class="step-number">3</div>
                            <h3>Historiales médicos</h3>
                            <p>Gestioná historiales médicos y emití recetas electrónicas</p>
                        </div>
                        <div class="step-card">
                            <div class="step-number">4</div>
                            <h3>Reportes</h3>
                            <p>Generá y visualizá reportes y estadísticas</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Turnos Page -->
        <section id="turnos-page" class="page">
            <div class="container">
                <div class="page-header">
                    <h1><i class="fas fa-calendar-check"></i> Reservar Turno Médico</h1>
                    <p>Complete los siguientes pasos para reservar su turno</p>
                </div>

                <!-- Stepper -->
                <div class="stepper">
                    <div class="step active" data-step="1">
                        <div class="step-circle">1</div>
                        <span>Paciente</span>
                    </div>
                    <div class="step-line"></div>
                    <div class="step" data-step="2">
                        <div class="step-circle">2</div>
                        <span>Especialidad</span>
                    </div>
                    <div class="step-line"></div>
                    <div class="step" data-step="3">
                        <div class="step-circle">3</div>
                        <span>Médico</span>
                    </div>
                    <div class="step-line"></div>
                    <div class="step" data-step="4">
                        <div class="step-circle">4</div>
                        <span>Horario</span>
                    </div>
                    <div class="step-line"></div>
                    <div class="step" data-step="5">
                        <div class="step-circle">5</div>
                        <span>Confirmar</span>
                    </div>
                </div>

                <!-- Step 1: Paciente -->
                <div class="step-content active" id="step-1">
                    <div class="card">
                        <h2>Datos del Paciente</h2>

                        <div class="tabs">
                            <button class="tab-btn active" data-tab="buscar-paciente">
                                <i class="fas fa-search"></i> Buscar Paciente
                            </button>
                            <button class="tab-btn" data-tab="nuevo-paciente">
                                <i class="fas fa-user-plus"></i> Nuevo Paciente
                            </button>
                        </div>

                        <!-- Buscar Paciente -->
                        <div class="tab-content active" id="buscar-paciente">
                            <div class="form-group">
                                <label for="buscar-dni">DNI del Paciente</label>
                                <div class="input-with-button">
                                    <input type="text" id="buscar-dni" placeholder="Ingrese DNI (sin puntos)"
                                        maxlength="10">
                                    <button class="btn btn-secondary" onclick="buscarPaciente()">
                                        <i class="fas fa-search"></i> Buscar
                                    </button>
                                </div>
                            </div>
                            <div id="paciente-encontrado" class="paciente-info" style="display: none;">
                                <div class="success-message">
                                    <i class="fas fa-check-circle"></i>
                                    <span>Paciente encontrado</span>
                                </div>
                                <div class="info-grid">
                                    <div><strong>Nombre:</strong> <span id="pac-nombre"></span></div>
                                    <div><strong>DNI:</strong> <span id="pac-dni"></span></div>
                                    <div><strong>Email:</strong> <span id="pac-email"></span></div>
                                    <div><strong>Teléfono:</strong> <span id="pac-telefono"></span></div>
                                </div>
                            </div>
                        </div>

                        <!-- Nuevo Paciente -->
                        <div class="tab-content" id="nuevo-paciente">
                            <form id="form-nuevo-paciente">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="pac-nuevo-dni">DNI *</label>
                                        <input type="text" id="pac-nuevo-dni" required maxlength="10">
                                    </div>
                                    <div class="form-group">
                                        <label for="pac-nombre-input">Nombre *</label>
                                        <input type="text" id="pac-nombre-input" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="pac-apellido">Apellido *</label>
                                        <input type="text" id="pac-apellido" required>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="pac-email-input">Email *</label>
                                        <input type="email" id="pac-email-input" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="pac-telefono-input">Teléfono *</label>
                                        <input type="tel" id="pac-telefono-input" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="pac-fecha-nacimiento">Fecha de Nacimiento *</label>
                                        <input type="date" id="pac-fecha-nacimiento" required>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="pac-direccion">Dirección *</label>
                                        <input type="text" id="pac-direccion" required>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="pac-obra-social">Obra Social</label>
                                        <input type="text" id="pac-obra-social">
                                    </div>
                                    <div class="form-group">
                                        <label for="pac-numero-afiliado">Número de Afiliado</label>
                                        <input type="text" id="pac-numero-afiliado">
                                    </div>
                                </div>
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save"></i> Registrar Paciente
                                </button>
                            </form>
                        </div>

                        <div class="step-actions">
                            <button class="btn btn-primary" onclick="nextStep(2)" id="btn-step-1">
                                Siguiente <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Step 2: Especialidad -->
                <div class="step-content" id="step-2">
                    <div class="card">
                        <h2>Seleccione una Especialidad</h2>
                        <div id="especialidades-grid" class="especialidades-grid">
                            <!-- Se carga dinámicamente -->
                        </div>
                        <div class="step-actions">
                            <button class="btn btn-secondary" onclick="prevStep(1)">
                                <i class="fas fa-arrow-left"></i> Anterior
                            </button>
                            <button class="btn btn-primary" onclick="nextStep(3)" id="btn-step-2" disabled>
                                Siguiente <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Step 3: Médico -->
                <div class="step-content" id="step-3">
                    <div class="card">
                        <h2>Seleccione un Médico</h2>
                        <div id="medicos-list" class="medicos-list">
                            <!-- Se carga dinámicamente -->
                        </div>
                        <div class="step-actions">
                            <button class="btn btn-secondary" onclick="prevStep(2)">
                                <i class="fas fa-arrow-left"></i> Anterior
                            </button>
                            <button class="btn btn-primary" onclick="nextStep(4)" id="btn-step-3" disabled>
                                Siguiente <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Step 4: Horario -->
                <div class="step-content" id="step-4">
                    <div class="card">
                        <div class="calendario-header">
                            <div class="calendario-title">
                                <h2>Seleccione Fecha y Horario</h2>
                                <p>Haga clic en un horario disponible (en blanco) para reservar su turno</p>
                            </div>

                            <!-- Controles de navegación -->
                            <div class="calendario-controls">
                                <button class="btn btn-sm btn-secondary" onclick="cambiarSemana(-1)">
                                    <i class="fas fa-chevron-left"></i> Semana Anterior
                                </button>
                                <div class="semana-actual">
                                    <i class="fas fa-calendar"></i>
                                    <span id="semana-texto">Cargando...</span>
                                </div>
                                <button class="btn btn-sm btn-secondary" onclick="cambiarSemana(1)">
                                    Semana Siguiente <i class="fas fa-chevron-right"></i>
                                </button>
                            </div>

                            <!-- Leyenda -->
                            <div class="calendario-leyenda">
                                <div class="leyenda-item">
                                    <span class="leyenda-color no-disponible"></span>
                                    <span>No disponible</span>
                                </div>
                                <div class="leyenda-item">
                                    <span class="leyenda-color disponible"></span>
                                    <span>Disponible</span>
                                </div>
                                <div class="leyenda-item">
                                    <span class="leyenda-color seleccionado"></span>
                                    <span>Seleccionado</span>
                                </div>
                            </div>
                        </div>

                        <!-- Calendario Semanal -->
                        <div class="calendario-wrapper">
                            <div id="calendario-semanal" class="calendario-semanal">
                                <!-- Se carga dinámicamente -->
                            </div>
                        </div>

                        <div class="step-actions">
                            <button class="btn btn-secondary" onclick="prevStep(3)">
                                <i class="fas fa-arrow-left"></i> Anterior
                            </button>
                            <button class="btn btn-primary" onclick="nextStep(5)" id="btn-step-4" disabled>
                                Siguiente <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Step 5: Confirmar -->
                <div class="step-content" id="step-5">
                    <div class="card">
                        <h2>Confirmar Reserva</h2>
                        <div class="resumen-turno">
                            <div class="resumen-item">
                                <i class="fas fa-user"></i>
                                <div>
                                    <strong>Paciente</strong>
                                    <p id="resumen-paciente">-</p>
                                </div>
                            </div>
                            <div class="resumen-item">
                                <i class="fas fa-stethoscope"></i>
                                <div>
                                    <strong>Especialidad</strong>
                                    <p id="resumen-especialidad">-</p>
                                </div>
                            </div>
                            <div class="resumen-item">
                                <i class="fas fa-user-md"></i>
                                <div>
                                    <strong>Médico</strong>
                                    <p id="resumen-medico">-</p>
                                </div>
                            </div>
                            <div class="resumen-item">
                                <i class="fas fa-calendar-alt"></i>
                                <div>
                                    <strong>Fecha y Hora</strong>
                                    <p id="resumen-fecha-hora">-</p>
                                </div>
                            </div>
                            <div class="resumen-item">
                                <i class="fas fa-clock"></i>
                                <div>
                                    <strong>Duración</strong>
                                    <p id="resumen-duracion">30 minutos</p>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="turno-motivo">Motivo de la Consulta (opcional)</label>
                            <textarea id="turno-motivo" rows="3"
                                placeholder="Describa brevemente el motivo de su consulta"></textarea>
                        </div>

                        <div class="step-actions">
                            <button class="btn btn-secondary" onclick="prevStep(4)">
                                <i class="fas fa-arrow-left"></i> Anterior
                            </button>
                            <button class="btn btn-success btn-large" onclick="confirmarTurno()">
                                <i class="fas fa-check"></i> Confirmar Turno
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Turnos Page -->
        <section id="mis-turnos-page" class="page">
            <div class="container">
                <div class="page-header">
                    <h1><i class="fas fa-list"></i> Turnos</h1>
                    <p>Consulta y gestiona tus turnos médicos</p>
                </div>

                <div class="card">
                    <div class="table-header">
                        <div class="form-group" style="margin: 0; flex: 1; max-width: 300px;">
                            <div class="input-with-button">
                                <input type="text" id="buscar-turnos-dni" placeholder="Buscar por DNI del paciente">
                                <button class="btn btn-primary" onclick="buscarTurnosPorDNI()">
                                    <i class="fas fa-search"></i>
                                </button>
                            </div>
                        </div>
                        <div class="form-group" style="margin: 0; max-width: 200px;">
                            <select id="filtro-estado-turno" class="form-control" onchange="cargarMisTurnos()">
                                <option value="">Todos los estados</option>
                                <option value="PEND">Pendientes</option>
                                <option value="CONF">Confirmados</option>
                                <option value="CANC">Cancelados</option>
                                <option value="ASIS">Asistidos</option>
                                <option value="INAS">Inasistidos</option>
                            </select>
                        </div>
                        <button class="btn btn-secondary" onclick="cargarTodosTurnos()">
                            <i class="fas fa-refresh"></i> Limpiar
                        </button>
                    </div>

                    <div class="table-responsive">
                        <table id="mis-turnos-table">
                            <thead>
                                <tr>
                                    <th>Fecha</th>
                                    <th>Hora</th>
                                    <th>Paciente</th>
                                    <th>DNI</th>
                                    <th>Médico</th>
                                    <th>Especialidad</th>
                                    <th>Estado</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="mis-turnos-tbody">
                                <!-- Se carga dinámicamente -->
                            </tbody>
                        </table>
                    </div>

                    <!-- Paginación -->
                    <div class="pagination" id="mis-turnos-pagination">
                        <!-- Se carga dinámicamente -->
                    </div>
                </div>
            </div>
        </section>

        <!-- Pacientes Page -->
        <section id="pacientes-page" class="page">
            <div class="container">
                <div class="page-header">
                    <h1><i class="fas fa-users"></i> Gestión de Pacientes</h1>
                    <p>Listado de pacientes registrados</p>
                </div>

                <div class="card">
                    <div class="table-header">
                        <button class="btn btn-primary" onclick="navegarRegistrarPaciente()">
                            <i class="fas fa-user-plus"></i> Nuevo Paciente
                        </button>
                    </div>
                    <div class="table-responsive">
                        <table id="pacientes-table">
                            <thead>
                                <tr>
                                    <th>DNI</th>
                                    <th>Nombre Completo</th>
                                    <th>Email</th>
                                    <th>Teléfono</th>
                                    <th>Fecha Nacimiento</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="pacientes-tbody">
                                <!-- Se carga dinámicamente -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- Medicos Page -->
        <section id="medicos-page" class="page">
            <div class="container">
                <div class="page-header">
                    <h1><i class="fas fa-user-md"></i> Gestión de Médicos</h1>
                    <p>Listado de profesionales de la salud</p>
                </div>

                <div class="card">
                    <div class="tabs">
                        <button class="tab-btn active" data-tab="lista-medicos">
                            <i class="fas fa-list"></i> Listado
                        </button>
                        <button class="tab-btn" data-tab="nuevo-medico">
                            <i class="fas fa-plus"></i> Nuevo Médico
                        </button>
                    </div>

                    <!-- Lista de Médicos -->
                    <div class="tab-content active" id="lista-medicos">
                        <div class="table-responsive">
                            <table id="medicos-table">
                                <thead>
                                    <tr>
                                        <th>Matrícula</th>
                                        <th>Nombre Completo</th>
                                        <th>Especialidades</th>
                                        <th>Email</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="medicos-tbody">
                                    <!-- Se carga dinámicamente -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Nuevo Médico -->
                    <div class="tab-content" id="nuevo-medico">
                        <form id="form-nuevo-medico">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="med-matricula">Matrícula *</label>
                                    <input type="text" id="med-matricula" required>
                                </div>
                                <div class="form-group">
                                    <label for="med-dni">DNI *</label>
                                    <input type="text" id="med-dni" required>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="med-nombre">Nombre *</label>
                                    <input type="text" id="med-nombre" required>
                                </div>
                                <div class="form-group">
                                    <label for="med-apellido">Apellido *</label>
                                    <input type="text" id="med-apellido" required>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="med-email">Email *</label>
                                    <input type="email" id="med-email" required>
                                </div>
                                <div class="form-group">
                                    <label for="med-telefono">Teléfono *</label>
                                    <input type="text" id="med-telefono" required>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Especialidades *</label>
                                <div id="med-especialidades-check" class="checkbox-grid">
                                    <!-- Se carga dinámicamente -->
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Registrar Médico
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </section>

        <!-- Reportes Page -->
        <section id="reportes-page" class="page">
            <div class="container">
                <div class="page-header">
                    <h1><i class="fas fa-chart-bar"></i> Reportes y Estadísticas</h1>
                    <p>Visualización de métricas del sistema</p>
                </div>

                <div class="card">
                    <div class="filters-section">
                        <h3>Filtros</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="reporte-fecha-inicio">Fecha Inicio</label>
                                <input type="date" id="reporte-fecha-inicio">
                            </div>
                            <div class="form-group">
                                <label for="reporte-fecha-fin">Fecha Fin</label>
                                <input type="date" id="reporte-fecha-fin">
                            </div>
                            <div class="form-group filtro-dinamico" id="filtro-medico-group">
                                <label for="reporte-medico-select">Médico <small class="text-muted">(opcional)</small></label>
                                <select id="reporte-medico-select" class="form-control">
                                    <option value="">Todos los médicos</option>
                                </select>
                            </div>
                            <div class="form-group filtro-dinamico" id="filtro-especialidad-group">
                                <label for="reporte-especialidad-select">Especialidad <small class="text-muted">(opcional)</small></label>
                                <select id="reporte-especialidad-select" class="form-control">
                                    <option value="">Todas las especialidades</option>
                                </select>
                            </div>
                            <div class="form-group" style="align-self: flex-end;">
                                <button class="btn btn-primary" onclick="actualizarReportes()">
                                    <i class="fas fa-sync"></i> Actualizar Reportes
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="tabs">
                        <button class="tab-btn active" data-tab="tab-asistencia" data-filtros="medico,especialidad">
                            <i class="fas fa-chart-pie"></i> Asistencia
                        </button>
                        <button class="tab-btn" data-tab="tab-especialidad" data-filtros="">
                            <i class="fas fa-chart-bar"></i> Especialidades
                        </button>
                        <button class="tab-btn" data-tab="tab-medicos" data-filtros="medico">
                            <i class="fas fa-user-md"></i> Turnos por Médico
                        </button>
                        <button class="tab-btn" data-tab="tab-pacientes" data-filtros="medico,especialidad">
                            <i class="fas fa-users"></i> Pacientes Atendidos
                        </button>
                    </div>

                    <!-- Tab Asistencia -->
                    <div class="tab-content active" id="tab-asistencia">
                        <div class="chart-container"
                            style="position: relative; height:40vh; width:80vw; max-width: 600px; margin: 0 auto;">
                            <canvas id="chart-asistencia"></canvas>
                        </div>
                    </div>

                    <!-- Tab Especialidades -->
                    <div class="tab-content" id="tab-especialidad">
                        <div class="chart-container"
                            style="position: relative; height:40vh; width:80vw; max-width: 800px; margin: 0 auto;">
                            <canvas id="chart-especialidad"></canvas>
                        </div>
                    </div>

                    <!-- Tab Médicos -->
                    <div class="tab-content" id="tab-medicos">
                        <div class="table-responsive">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <h4>Listado de Turnos</h4>
                                <h5 id="total-turnos-medico" class="text-primary">Total: 0</h5>
                            </div>
                            <table id="reporte-medico-table">
                                <thead>
                                    <tr>
                                        <th>Fecha y Hora</th>
                                        <th>Paciente</th>
                                        <th>Especialidad</th>
                                        <th>Estado</th>
                                    </tr>
                                </thead>
                                <tbody id="reporte-medico-tbody">
                                    <!-- Dinámico -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Tab Pacientes -->
                    <div class="tab-content" id="tab-pacientes">
                        <div class="table-responsive">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <h4>Listado de Pacientes</h4>
                                <h5 id="total-pacientes-atendidos" class="text-primary">Total: 0</h5>
                            </div>
                            <table id="reporte-pacientes-table">
                                <thead>
                                    <tr>
                                        <th>Fecha</th>
                                        <th>Paciente</th>
                                        <th>DNI</th>
                                        <th>Médico</th>
                                        <th>Especialidad</th>
                                    </tr>
                                </thead>
                                <tbody id="reporte-pacientes-tbody">
                                    <!-- Dinámico -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Especialidades Page -->
        <section id="especialidades-page" class="page">
            <div class="container">
                <div class="page-header">
                    <h1><i class="fas fa-stethoscope"></i> Gestión de Especialidades</h1>
                    <p>Administre las especialidades médicas del sistema</p>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3>Especialidades Médicas</h3>
                        <button id="btn-nueva-especialidad" class="btn btn-primary">
                            <i class="fas fa-plus"></i> Nueva Especialidad
                        </button>
                    </div>
                    <div class="table-responsive">
                        <table id="especialidades-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Nombre</th>
                                    <th>Descripción</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="especialidades-tbody">
                                <!-- Dinámico -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- Modal Especialidad -->
        <div id="modal-especialidad" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="especialidad-modal-titulo">Nueva Especialidad</h2>
                    <button class="modal-close" onclick="cerrarModalEspecialidad()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <form id="form-especialidad">
                    <div class="form-group">
                        <label for="especialidad-nombre">Nombre *</label>
                        <input type="text" id="especialidad-nombre" required minlength="3" maxlength="100"
                               placeholder="Ej: Cardiología, Pediatría">
                    </div>
                    <div class="form-group">
                        <label for="especialidad-descripcion">Descripción</label>
                        <textarea id="especialidad-descripcion" rows="3" maxlength="500"
                                  placeholder="Descripción de la especialidad (opcional)"></textarea>
                    </div>
                    <div class="modal-actions">
                        <button type="button" class="btn btn-secondary" onclick="cerrarModalEspecialidad()">
                            Cancelar
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Guardar
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Horarios Page -->
        <section id="horarios-page" class="page">
            <div class="container">
                <div class="page-header">
                    <h1><i class="fas fa-clock"></i> Gestión de Horarios y Disponibilidad</h1>
                    <p>Asigne horarios semanales y gestione bloqueos de médicos</p>
                </div>

                <!-- Selector de Médico -->
                <div class="card">
                    <h3><i class="fas fa-user-md"></i> Seleccionar Médico</h3>
                    <div class="form-group">
                        <label for="medico-horarios-select">Médico</label>
                        <select id="medico-horarios-select" class="form-control">
                            <option value="">-- Seleccione un médico --</option>
                        </select>
                    </div>
                </div>

                <!-- Sección Disponibilidades -->
                <div id="seccion-disponibilidades" class="card" style="display: none;">
                    <div class="card-header">
                        <h3><i class="fas fa-calendar-week"></i> Horarios Semanales</h3>
                        <button id="btn-nueva-disponibilidad" class="btn btn-primary">
                            <i class="fas fa-plus"></i> Agregar Horario
                        </button>
                    </div>
                    <div id="disponibilidades-container">
                        <p class="text-muted">Seleccione un médico para ver sus horarios</p>
                    </div>
                </div>

                <!-- Sección Bloqueos -->
                <div id="seccion-bloqueos" class="card" style="display: none;">
                    <div class="card-header">
                        <h3><i class="fas fa-ban"></i> Bloqueos y Vacaciones</h3>
                        <button id="btn-nuevo-bloqueo" class="btn btn-primary">
                            <i class="fas fa-plus"></i> Agregar Bloqueo
                        </button>
                    </div>
                    <div id="bloqueos-container">
                        <p class="text-muted">Seleccione un médico para ver sus bloqueos</p>
                    </div>
                </div>

                <!-- Modal Disponibilidad -->
    <div id="modal-disponibilidad" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="disponibilidad-titulo">Agregar Horario</h2>
                <button class="modal-close" onclick="cancelarFormularioDisponibilidad()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="form-disponibilidad">
                <div class="form-group">
                    <label for="disp-dia-semana">Día de la Semana *</label>
                    <select id="disp-dia-semana" required>
                        <option value="">-- Seleccione --</option>
                        <option value="0">Domingo</option>
                        <option value="1">Lunes</option>
                        <option value="2">Martes</option>
                        <option value="3">Miércoles</option>
                        <option value="4">Jueves</option>
                        <option value="5">Viernes</option>
                        <option value="6">Sábado</option>
                    </select>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="disp-hora-desde">Hora Desde *</label>
                        <input type="time" id="disp-hora-desde" required>
                    </div>
                    <div class="form-group">
                        <label for="disp-hora-hasta">Hora Hasta *</label>
                        <input type="time" id="disp-hora-hasta" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="disp-duracion-slot">Duración del Turno (minutos) *</label>
                    <select id="disp-duracion-slot" required>
                        <option value="15">15 minutos</option>
                        <option value="20">20 minutos</option>
                        <option value="30" selected>30 minutos</option>
                        <option value="45">45 minutos</option>
                        <option value="60">60 minutos</option>
                    </select>
                </div>
                <div class="modal-actions">
                    <button type="button" id="btn-cancelar-disponibilidad" class="btn btn-secondary" 
                            onclick="cancelarFormularioDisponibilidad()">
                        Cancelar
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Guardar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Bloqueo -->
    <div id="modal-bloqueo" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="bloqueo-titulo">Agregar Bloqueo</h2>
                <button class="modal-close" onclick="cancelarFormularioBloqueo()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="form-bloqueo">
                <div class="form-row">
                    <div class="form-group">
                        <label for="bloqueo-inicio">Fecha de Inicio *</label>
                        <input type="date" id="bloqueo-inicio" required>
                    </div>
                    <div class="form-group">
                        <label for="bloqueo-fin">Fecha de Fin *</label>
                        <input type="date" id="bloqueo-fin" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="bloqueo-motivo">Motivo</label>
                    <textarea id="bloqueo-motivo" rows="3" 
                              placeholder="Ej: Vacaciones, Capacitación, etc."></textarea>
                </div>
                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i>
                    El bloqueo será por días completos (de 00:00 a 23:59). No podrá crear bloqueos si existen turnos confirmados en ese período.
                </div>
                <div class="modal-actions">
                    <button type="button" id="btn-cancelar-bloqueo" class="btn btn-secondary" 
                            onclick="cancelarFormularioBloqueo()">
                        Cancelar
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Guardar
                    </button>
                </div>
            </form>
        </div>
    </div>
            </div>
        </section>

        <!-- Historial Clínico Page -->
        <section id="historial-page" class="page">
            <div class="container">
                <div class="page-header">
                    <h1><i class="fas fa-file-medical"></i> Historial Clínico de Pacientes</h1>
                    <p>Consulte y gestione el historial médico de los pacientes</p>
                </div>

                <!-- Buscador de Paciente -->
                <div class="card">
                    <h3><i class="fas fa-search"></i> Buscar Paciente</h3>
                    <div class="form-row">
                        <div class="form-group" style="flex: 2;">
                            <label for="historial-buscar-dni">DNI del Paciente</label>
                            <div class="input-with-button">
                                <input type="text" id="historial-buscar-dni" placeholder="Ingrese DNI (sin puntos)" maxlength="10">
                                <button class="btn btn-primary" onclick="buscarHistorialPorDNI()">
                                    <i class="fas fa-search"></i> Buscar
                                </button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="historial-fecha-desde">Desde</label>
                            <input type="date" id="historial-fecha-desde">
                        </div>
                        <div class="form-group">
                            <label for="historial-fecha-hasta">Hasta</label>
                            <input type="date" id="historial-fecha-hasta">
                        </div>
                    </div>
                </div>

                <!-- Información del Paciente -->
                <div id="historial-paciente-info" class="card" style="display: none;">
                    <div class="historial-header">
                        <div class="paciente-resumen">
                            <h3><i class="fas fa-user"></i> <span id="historial-paciente-nombre">-</span></h3>
                            <p><strong>DNI:</strong> <span id="historial-paciente-dni">-</span></p>
                        </div>
                        <div class="historial-stats">
                            <div class="stat-item">
                                <span class="stat-number" id="historial-total-consultas">0</span>
                                <span class="stat-label">Consultas</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-number" id="historial-total-recetas">0</span>
                                <span class="stat-label">Recetas</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Lista de Consultas -->
                <div id="historial-consultas-container" class="card" style="display: none;">
                    <div class="card-header">
                        <h3><i class="fas fa-notes-medical"></i> Historial de Consultas</h3>
                    </div>
                    <div id="historial-consultas-list" class="consultas-timeline">
                        <!-- Se carga dinámicamente -->
                    </div>
                    <div id="historial-sin-consultas" class="empty-state" style="display: none;">
                        <i class="fas fa-clipboard-list"></i>
                        <p>Este paciente no tiene consultas registradas</p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Modal Ver Consulta Detalle -->
    <div id="modal-ver-consulta" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2><i class="fas fa-file-medical-alt"></i> Detalle de Consulta</h2>
                <button class="modal-close" onclick="cerrarModalVerConsulta()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="consulta-detalle">
                <div class="consulta-info-grid">
                    <div class="info-item">
                        <label>Fecha de Atención</label>
                        <span id="consulta-det-fecha">-</span>
                    </div>
                    <div class="info-item">
                        <label>Médico</label>
                        <span id="consulta-det-medico">-</span>
                    </div>
                    <div class="info-item">
                        <label>Especialidad</label>
                        <span id="consulta-det-especialidad">-</span>
                    </div>
                </div>
                
                <div class="consulta-seccion">
                    <h4><i class="fas fa-comment-medical"></i> Motivo de Consulta</h4>
                    <p id="consulta-det-motivo" class="consulta-texto">-</p>
                </div>
                
                <div class="consulta-seccion">
                    <h4><i class="fas fa-stethoscope"></i> Diagnóstico</h4>
                    <p id="consulta-det-diagnostico" class="consulta-texto">-</p>
                </div>
                
                <div class="consulta-seccion">
                    <h4><i class="fas fa-eye"></i> Observaciones</h4>
                    <p id="consulta-det-observaciones" class="consulta-texto">-</p>
                </div>
                
                <div class="consulta-seccion">
                    <h4><i class="fas fa-clipboard-list"></i> Indicaciones</h4>
                    <p id="consulta-det-indicaciones" class="consulta-texto">-</p>
                </div>
                
                <!-- Recetas asociadas -->
                <div class="consulta-seccion">
                    <h4><i class="fas fa-prescription"></i> Recetas Emitidas</h4>
                    <div id="consulta-det-recetas" class="recetas-list">
                        <!-- Se carga dinámicamente -->
                    </div>
                </div>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" onclick="cerrarModalVerConsulta()">
                    Cerrar
                </button>
                <button type="button" class="btn btn-success" onclick="emitirRecetaDesdeConsulta()">
                    <i class="fas fa-prescription"></i> Nueva Receta
                </button>
                <button type="button" class="btn btn-primary" onclick="abrirModalEditarConsulta()">
                    <i class="fas fa-edit"></i> Editar
                </button>
            </div>
        </div>
    </div>

    <!-- Modal Crear/Editar Consulta -->
    <div id="modal-consulta" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2 id="modal-consulta-titulo"><i class="fas fa-notes-medical"></i> Nueva Consulta</h2>
                <button class="modal-close" onclick="cerrarModalConsulta()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="form-consulta">
                <input type="hidden" id="consulta-id">
                <input type="hidden" id="consulta-turno-id">
                
                <div class="form-group">
                    <label for="consulta-motivo">Motivo de la Consulta</label>
                    <textarea id="consulta-motivo" rows="2" placeholder="Describa el motivo de la consulta"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="consulta-diagnostico">Diagnóstico *</label>
                    <textarea id="consulta-diagnostico" rows="3" required placeholder="Ingrese el diagnóstico médico"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="consulta-observaciones">Observaciones</label>
                    <textarea id="consulta-observaciones" rows="3" placeholder="Observaciones clínicas adicionales"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="consulta-indicaciones">Indicaciones al Paciente</label>
                    <textarea id="consulta-indicaciones" rows="3" placeholder="Indicaciones y recomendaciones para el paciente"></textarea>
                </div>
                
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="cerrarModalConsulta()">
                        Cancelar
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Guardar Consulta
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Crear Receta -->
    <div id="modal-receta" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2><i class="fas fa-prescription"></i> Nueva Receta Electrónica</h2>
                <button class="modal-close" onclick="cerrarModalReceta()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="form-receta">
                <input type="hidden" id="receta-consulta-id">
                
                <div id="receta-items-container">
                    <!-- Items de receta se agregan dinámicamente -->
                </div>
                
                <button type="button" class="btn btn-secondary" onclick="agregarItemReceta()">
                    <i class="fas fa-plus"></i> Agregar Medicamento
                </button>
                
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="cerrarModalReceta()">
                        Cancelar
                    </button>
                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-file-prescription"></i> Emitir Receta
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Editar Paciente -->
    <div id="modal-editar-paciente" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Editar Paciente</h2>
                <button class="modal-close" onclick="cerrarModalEditarPaciente()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="form-editar-paciente">
                <input type="hidden" id="edit-pac-id">
                <div class="form-row">
                    <div class="form-group">
                        <label for="edit-pac-dni">DNI *</label>
                        <input type="text" id="edit-pac-dni" required maxlength="10">
                    </div>
                    <div class="form-group">
                        <label for="edit-pac-nombre">Nombre *</label>
                        <input type="text" id="edit-pac-nombre" required>
                    </div>
                    <div class="form-group">
                        <label for="edit-pac-apellido">Apellido *</label>
                        <input type="text" id="edit-pac-apellido" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="edit-pac-email">Email *</label>
                        <input type="email" id="edit-pac-email" required>
                    </div>
                    <div class="form-group">
                        <label for="edit-pac-telefono">Teléfono *</label>
                        <input type="tel" id="edit-pac-telefono" required>
                    </div>
                    <div class="form-group">
                        <label for="edit-pac-fecha-nacimiento">Fecha de Nacimiento *</label>
                        <input type="date" id="edit-pac-fecha-nacimiento" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="edit-pac-direccion">Dirección *</label>
                        <input type="text" id="edit-pac-direccion" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="edit-pac-obra-social">Obra Social</label>
                        <input type="text" id="edit-pac-obra-social">
                    </div>
                    <div class="form-group">
                        <label for="edit-pac-numero-afiliado">Número de Afiliado</label>
                        <input type="text" id="edit-pac-numero-afiliado">
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="cerrarModalEditarPaciente()">
                        Cancelar
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Guardar Cambios
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Editar Médico -->
    <div id="modal-editar-medico" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Editar Médico</h2>
                <button class="modal-close" onclick="cerrarModalEditarMedico()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="form-editar-medico">
                <input type="hidden" id="edit-med-id">
                <div class="form-row">
                    <div class="form-group">
                        <label for="edit-med-matricula">Matrícula *</label>
                        <input type="text" id="edit-med-matricula" required disabled>
                        <small style="color: var(--text-secondary);">La matrícula no se puede modificar</small>
                    </div>
                    <div class="form-group">
                        <label for="edit-med-dni">DNI *</label>
                        <input type="text" id="edit-med-dni" required disabled>
                        <small style="color: var(--text-secondary);">El DNI no se puede modificar</small>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="edit-med-nombre">Nombre *</label>
                        <input type="text" id="edit-med-nombre" required>
                    </div>
                    <div class="form-group">
                        <label for="edit-med-apellido">Apellido *</label>
                        <input type="text" id="edit-med-apellido" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="edit-med-email">Email *</label>
                        <input type="email" id="edit-med-email" required>
                    </div>
                    <div class="form-group">
                        <label for="edit-med-telefono">Teléfono *</label>
                        <input type="tel" id="edit-med-telefono" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="edit-med-direccion">Dirección</label>
                        <input type="text" id="edit-med-direccion">
                    </div>
                    <div class="form-group">
                        <label for="edit-med-genero">Género</label>
                        <select id="edit-med-genero">
                            <option value="">-- Seleccione --</option>
                            <option value="Masculino">Masculino</option>
                            <option value="Femenino">Femenino</option>
                            <option value="Otro">Otro</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Especialidades *</label>
                    <div id="edit-med-especialidades-check" class="checkbox-grid">
                        <!-- Se carga dinámicamente -->
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="cerrarModalEditarMedico()">
                        Cancelar
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Guardar Cambios
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay" style="display: none;">
        <div class="spinner"></div>
        <p>Cargando...</p>
    </div>

    <!-- Toast Notifications -->
    <div id="toast-container" class="toast-container"></div>

    <script src="/static/js/api.js?v=7"></script>
    <script src="/static/js/reportes.js?v=10"></script>
    <script src="/static/js/especialidades.js?v=1"></script>
    <script src="/static/js/horarios.js?v=4"></script>
    <script src="/static/js/historial.js?v=1"></script>
    <script src="/static/js/app.js?v=11"></script>
</body>

</html>